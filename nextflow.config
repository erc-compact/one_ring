
plugins {
    id 'nf-live-tracking@2.0.0'
}

params {

//Observation INFO
project = "COMPACT"
pipeline_name = "Segmented Acceleration Search"
telescope = "MeerKAT"
target = "M28"
files_to_search="${baseDir}/sample_file.txt"
outputdir = "results" //Fill in the beam name here in production
use_kafka = 1

readfile{
    parser = "${baseDir}/readfile_parser.sh"
}

filtool {
    rfi_filter = "kadaneF 8 4 zdot"
    zap_string = ""
    additional_flags = "" //(eg -scloffs)
    telescope = "meerkat"
    filplan = ""
    threads = 12
    time_decimation_factor = 1
    freq_decimation_factor = 1
    nbits = 8
    mean = 128
    std = 6
    get_metadata = "${baseDir}/get_metadata.py"

}

// Define a list of configurations, each one corresponding to a peasoup run.
// A user can have one, or many. If only one is desired, provide a single map.
peasoup = [
        // First run configuration
    [
        fft_size        : "134217728",
        start_sample    : "0",
        nsamples        : null,
        acc_start       : "-30.0",
        acc_end         : "30.0",
        dm_pulse_width  : "64",
        acc_pulse_width : "64",
        min_snr         : "8.0",
        ram_limit_gb    : "100.0",
        nh              : "5",
        ngpus           : "1",
        total_cands     : "100000",
        accel_tol       : 1.11,
        birdie_list     : null,
        chan_mask       : null
    ],

       // Second run configuration (example)
    [
        fft_size        : "67108864",
        start_sample    : "0",
        nsamples        : null,
        acc_start       : "-100.0",
        acc_end         : "100.0",
        dm_pulse_width  : "64",
        acc_pulse_width : "64",
        min_snr         : "7.5",
        ram_limit_gb    : "50.0",
        nh              : "5",
        ngpus           : "1",
        total_cands     : "50000",
        accel_tol       : 1.11,
        birdie_list     : null,
        chan_mask       : null
    ],

    // Third run configuration (example)
    [
        fft_size        : "67108864",
        start_sample    : "67108864",
        nsamples        : null,
        acc_start       : "-100.0",
        acc_end         : "100.0",
        dm_pulse_width  : "64",
        acc_pulse_width : "64",
        min_snr         : "7.5",
        ram_limit_gb    : "50.0",
        nh              : "5",
        ngpus           : "1",
        total_cands     : "50000",
        accel_tol       : 1.11,
        birdie_list     : null,
        chan_mask       : null
    ]

]
//DM files below will be applied to all peasoup configurations above (cartesian product). Applicable for all projects except COMPACT.
peasoup_dm_files {
        file_list  = "${baseDir}/dm_file*.txt"
}

pulsarx{
    fast_nbins = 128
    slow_nbins = 64
    nsubband = 64
    subint_length = null //Default value. Tobs/64
    fold_template = "${baseDir}/meerkat_fold.template"
    clfd_q_value = 2.0
    rfi_filter = "zdot"
    threads = 12

}

prepfold{
    ncpus = 6 //Number of parallel folds
    mask = null
}

rfifind{
    rfifind_time = "2.2"
    rfifind_freqsig = "3.0"
    rfifind_timesig = "10.0"
    rfifind_intfrac = "0.3"
    rfifind_chanfrac = "0.7"
    rfifind_nthreads = "4"
}

folding {
    fold_script = "${baseDir}/fold_peasoup_candidates.py"
}
   
kafka {
server = "localhost:9092"
schema_registry_url = "http://localhost:8081"
schema_file = "${baseDir}/avro_schema/Processing.avsc"
topic = "processing"
message_create= "${baseDir}/create_message.py"
producer_script = "${baseDir}/kafka_producer.py"
save_search_candidate_uuid = "${baseDir}/generate_uuid_search_candidate.py"
merged_fold_search = "${baseDir}/merge_fold_candidates_for_kafka.py"
}

candyjar{
    prepare_candyjar = "${baseDir}/prepare_cands_for_candyjar.py"
}

live {
    enabled = true
    file = "${params.outputdir}/PROGRESS"
    overwrite = true
    interval = 5  // Interval in seconds for JSON dumps

}

weblog {
    enabled = true
    url = 'http://localhost:8000/weblog'
}


}

profiles {
   local {
    includeConfig 'local.config'   
 }
   hercules {
    includeConfig 'hercules.config'
  }
  ozstar {
    includeConfig 'ozstar.config'
  }
  nt {
    includeConfig 'nt.config'
  }
  contra {
    includeConfig 'contra.config'
  }
  }


